FROM golang:1.13.15

USER root
ARG COMMITID

ENV symbol=\!
ENV GO111MODULE=on
ENV TZ=Asia/Taipei
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

WORKDIR /go/src/app

RUN apt-get update && apt-get upgrade -y && apt-get autoremove
RUN git clone http://tim:${symbol}Minnotec2025@mit7f.ddns.me:9700/R5012/IoMS5Data.git
WORKDIR IoMS5Data

RUN git checkout ${COMMITID}
RUN git rev-list --format=%B --max-count=1 ${COMMITID} >> version.txt
RUN date +"%Y/%m/%d-%T" >> version.txt
RUN go build -o s5data

ENTRYPOINT ./s5data

EXPOSE 8885
